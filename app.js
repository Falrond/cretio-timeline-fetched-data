let data = [
  {
    id: 1,
    title: "Adam and Eve",
    description:
      "Adam (Hebrew: אָדָם‎‎‎ ʾĀḏām; Aramaic: ܐܕܡ; Arabic: آدَم‎, romanized: ʾĀdam; Greek: Ἀδάμ, romanized: Adám; Latin: Adam) and Eve (חַוָּה‎ ‎‎Ḥavvā; Arabic: حَوَّاء‎, romanized: Ḥawwāʾ; Greek: Εὕα, romanized: Heúa; Latin: Eva, Heva; Syriac: ܚܰܘܳܐ romanized: ḥawâ) according to the creation myth of the Abrahamic religions,[1][2] were the first man and woman. They are central to the belief that humanity is in essence a single family, with everyone descended from a single pair of original ancestors.[3] They also provide the basis for the doctrines of the fall of man and original sin that are important beliefs in Christianity, although not held in Judaism or Islam.[4]In the Book of Genesis of the Hebrew Bible, chapters one through five, there are two creation narratives with two distinct perspectives. In the first, Adam and Eve are not named. Instead, God created humankind in God's image and instructed them to multiply and to be stewards over everything else that God had made. In the second narrative, God fashions Adam from dust and places him in the Garden of Eden. Adam is told that he can eat freely of all the trees in the garden, except for a tree of the knowledge of good and evil. Subsequently, Eve is created from one of Adam's ribs to be his companion. They are innocent and unembarrassed about their nakedness. However, a serpent convinces Eve to eat fruit from the forbidden tree, and she gives some of the fruit to Adam. These acts give them additional knowledge, but it gives them the ability to conjure negative and destructive concepts such as shame and evil. God later curses the serpent and the ground. God prophetically tells the woman and the man what will be the consequences of their sin of disobeying God. Then he banishes them from the Garden of Eden. ",
    term_type: "event",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/6/61/Peter_Paul_Rubens_004.jpg/464px-Peter_Paul_Rubens_004.jpg",
    latitude: "",
    longitude: "",
    date: -4004,
    on_timeline: true,
  },
  {
    id: 2,
    title: "Noah and the Great Flood",
    description:
      "In the traditions of Abrahamic religions, Noah[a] (/ˈnoʊ.ə/)[1] features as the tenth and last of the pre-Flood patriarchs. His story appears in the Hebrew Bible (in the Book of Genesis, chapters 5–9) and in the Quran. The Genesis flood narrative is among the best-known stories of the Bible. Noah is also portrayed as a 'tiller of the soil' and as a drinker of wine.According to the Genesis account, Noah labored faithfully to build the Ark at God's command, ultimately saving not only his own family, but mankind itself and all land animals, from extinction during the Flood. Afterwards, God made a covenant with Noah and promised never again to destroy all the Earth's creatures with a flood. The flood narrative is followed by the story of the Curse of Ham.In addition to his appearance in the Book of Genesis, Noah is mentioned in the Hebrew Bible in the First Book of Chronicles, and the books of Tobit, Wisdom, Sirach, Isaiah, Ezekiel, 2 Esdras, 4 Maccabees; the New Testament references him in the gospels of Matthew and Luke, and in the epistles (Epistle to the Hebrews, 1st Peter and 2nd Peter). Noah became the subject of much elaboration in the literature of later Abrahamic religions, including the Quran (Surahs 71, 7, 11, 54, and 21). ",
    term_type: "person",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/NoahsSacrifice.JPG/250px-NoahsSacrifice.jpg",
    term_type: "event",
    latitude: 39.7,
    longitude: 44.283333,
    date: -2348,
    on_timeline: true,
    relates: [11],
  },
  {
    id: 3,
    title: "The Exodus",
    description:
      "The Exodus (Hebrew: יציאת מצרים, Yeẓi’at Miẓrayim: lit. 'Departure from Egypt') is the founding myth[a] of the Israelites.[1][b] It tells a story of Israelite enslavement and departure from Egypt, revelations at biblical Mount Sinai, and wanderings in the wilderness up to the borders of Canaan.[2] Its message is that the Israelites were delivered from slavery by Yahweh their god, and therefore belong to him by covenant.[1]The consensus of modern scholars is that the Torah does not give an accurate account of the origins of the Israelites, who appear instead to have formed as an entity in the central highlands of Canaan in the late second millennium BCE from the indigenous Canaanite culture.[3][4][5] Most modern scholars believe that the story of the Exodus has some historical basis,[6][7] but contains little material that is provable.[8]The narrative of the Exodus is spread over four of the biblical books of the Torah or Pentateuch, namely Exodus, Leviticus, Numbers, and Deuteronomy. There is a widespread agreement that the composition of the Torah took place in the Middle Persian Period (5th century BCE),[9] although some traditions behind it are older since allusions to the story are made by 8th-century BCE prophets such as Amos and Hosea.[10][11] ",
    term_type: "event",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/6/6e/David_Roberts-IsraelitesLeavingEgypt_1828.jpg/300px-David_Roberts-IsraelitesLeavingEgypt_1828.jpg",
    latitude: 29.5,
    longitude: 33.833333,
    date: -1491,
    on_timeline: true,
    relates: [17, 20],
  },
  {
    id: 4,
    title: "Babylonian Captivity",
    description:
      "The Babylonian captivity or Babylonian exile is the period in Jewish history during which a number of people from the ancient Kingdom of Judah were captives in Babylon, the capital of the Neo-Babylonian Empire.After the Battle of Carchemish in 605 BCE, King Nebuchadnezzar of Babylon besieged Jerusalem, resulting in tribute being paid by King Jehoiakim.[1] Jehoiakim refused to pay tribute in Nebuchadnezzar's fourth year, which led to another siege in Nebuchadnezzar's seventh year, culminating with the death of Jehoiakim and the exile to Babylonia of King Jeconiah, his court and many others; Jeconiah's successor Zedekiah and others were exiled in Nebuchadnezzar's 18th year; a later deportation occurred in Nebuchadnezzar's 23rd year. The dates, numbers of deportations, and numbers of deportees given in the biblical accounts vary.[2] These deportations are dated to 597 BCE for the first, with others dated at 587/586 BCE, and 582/581 BCE respectively.[3]After the fall of Babylon to the Persian king Cyrus the Great in 539 BCE, exiled Judeans were permitted to return to Judah.[4][5] According to the biblical book of Ezra, construction of the Second Temple in Jerusalem began around 537 BCE. All these events are considered significant in Jewish history and culture, and had a far-reaching impact on the development of Judaism.",
    term_type: "event",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/8/8f/Tissot_The_Flight_of_the_Prisoners.jpg/300px-Tissot_The_Flight_of_the_Prisoners.jpg",
    latitude: 31.532569,
    longitude: 35.099825,
    date: -598,
    on_timeline: true,
    relates: [],
  },
  {
    id: 5,
    title: "Date of birth of Jesus",
    description:
      "The date of birth of Jesus is not stated in the gospels or in any historical reference, but most theologians assume a year of birth between 6 and 4 BC.[1] The historical evidence is too incomplete to allow a definitive dating,[2] but the year is estimated through three different approaches: (A) by analyzing references to known historical events mentioned in the nativity accounts in the Gospels of Luke and Matthew, (B) by working backward from the estimation of the start of the ministry of Jesus,[3][4] and (C) astrological or astronomical alignments.[5] The day or season has been estimated by various methods, including the description of shepherds watching over their sheep.[6]",
    term_type: "event",
    image:
      "https://ocdn.eu/pulscms-transforms/1/Zcek9kpTURBXy9lMWY5NmZhNWRlMGMxNzc5OWJiZjU5ZDg2NzE5YTc0OS5qcGeTlQMAzODNB9DNBGWTBc0DFM0BvJMJpjAxZTYyZgaBoTAB/boze-narodzenie-obraz-bartolome-estebana-murillo-xvii-w.jpg",
    latitude: 31.703056,
    longitude: 35.195556,
    date: -4,
    on_timeline: true,
    relates: [11, 13, 15, 17, 18, 14, 12, 19],
  },
  {
    id: 6,
    title: "Crucifixion of Jesus",
    description:
      "The crucifixion of Jesus occurred in 1st-century Judea, most likely in either AD 30 or AD 33. Jesus' crucifixion is described in the four canonical gospels, referred to in the New Testament epistles, attested to by other ancient sources, and is established as a historical event confirmed by non-Christian sources,[1] although there is no consensus among historians on the exact details.[2][3][4]According to the canonical gospels, Jesus was arrested and tried by the Sanhedrin, and then sentenced by Pontius Pilate to be scourged, and finally crucified by the Romans.[5][6][7] It portrays his death as a sacrifice for sin.Jesus was stripped of his clothing and offered vinegar mixed with myrrh or gall (likely posca[8]), to drink after saying 'I am thirsty'. He was then hung between two convicted thieves and, according to the Gospel of Mark, died by the 9th hour of the day (at around 3:00 p.m.). During this time, the soldiers affixed a sign to the top of the cross stating 'Jesus of Nazareth, King of the Jews' which, according to the Gospel of John (John 19:20), was written in three languages (Hebrew, Latin, and Greek). They then divided his garments among themselves and cast lots for his seamless robe, according to the Gospel of John. According to the Gospel of John, after Jesus' death, one soldier (named in extra-Biblical tradition as Longinus) pierced his side with a spear to be certain that he had died, then blood and water gushed from the wound. The Bible describes seven statements that Jesus made while he was on the cross, as well as several supernatural events that occurred.",
    term_type: "event",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Cristo_crucificado.jpg/240px-Cristo_crucificado.jpg",
    latitude: 31.778611,
    longitude: 35.229444,
    date: 33,
    on_timeline: true,
    relates: [11, 12, 20],
  },
  {
    id: 7,
    title: "Constantine the Great and Christianity",
    description:
      "During the reign of the Roman Emperor Constantine the Great (AD 306–337), Christianity began to transition to the dominant religion of the Roman Empire. Historians remain uncertain about Constantine's reasons for favoring Christianity, and theologians and historians have often argued about which form of early Christianity he subscribed to. There is no consensus among scholars as to whether he adopted his mother Helena's Christianity in his youth, or, as claimed by Eusebius of Caesarea, encouraged her to convert to the faith he had adopted himself.Constantine ruled the Roman Empire as sole emperor for much of his reign. Some scholars allege that his main objective was to gain unanimous approval and submission to his authority from all classes, and therefore chose Christianity to conduct his political propaganda, believing that it was the most appropriate religion that could fit with the Imperial cult (see also Sol Invictus). Regardless, under the Constantinian dynasty Christianity expanded throughout the Empire, launching the era of State church of the Roman Empire.[1][full citation needed] Whether Constantine sincerely converted to Christianity or remained loyal to Paganism is a matter of debate among historians (see also Constantine's religious policy).[2] His formal conversion in 312 is almost universally acknowledged among historians,[1][3][full citation needed] despite that it was claimed he was baptized only on his deathbed by the Arian bishop Eusebius of Nicomedia in 337;[4][5][6] the real reasons behind it remain unknown and are debated also.[2][3] According to Hans Pohlsander, Professor Emeritus of History at the University at Albany, SUNY, Constantine's conversion was just another instrument of realpolitik in his hands meant to serve his political interest in keeping the Empire united under his control:The prevailing spirit of Constantine's government was one of conservatorism. His conversion to and support of Christianity produced fewer innovations than one might have expected; indeed they served an entirely conservative end, the preservation and continuation of the Empire. — Hans Pohlsander, The Emperor Constantine[7]",
    term_type: "person",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f3/BnF_MS_Gr510_folio_440_recto_-_detail_-_Constantine%27s_Vision_and_the_Battle_of_the_Milvian_Bridge.jpg/800px-BnF_MS_Gr510_folio_440_recto_-_detail_-_Constantine%27s_Vision_and_the_Battle_of_the_Milvian_Bridge.jpg",
    latitude: 41.883333,
    longitude: 12.5,
    date: 330,
    on_timeline: true,
    relates: [13, 14],
  },
  {
    id: 8,
    title: "The Ottoman Empire founded",
    description:
      "The Ottoman Empire (/ˈɒtəmən/; Ottoman Turkish: دولت عليه عثمانيه‎ Devlet-i ʿAlīye-i ʿOsmānīye, lit. 'The Sublime Ottoman State'; Turkish: Osmanlı İmparatorluğu or Osmanlı Devleti; French: Empire ottoman)[note 5][17] was a state[note 6] that controlled much of Southeastern Europe, Western Asia, and Northern Africa between the 14th and early 20th centuries. It was founded at the end of the 13th century in northwestern Anatolia in the town of Söğüt (modern-day Bilecik Province) by the Turkoman[18][19] tribal leader Osman I.[20] After 1354, the Ottomans crossed into Europe and with the conquest of the Balkans, the Ottoman beylik was transformed into a transcontinental empire. The Ottomans ended the Byzantine Empire with the conquest of Constantinople in 1453 by Mehmed the Conqueror.Under the reign of Suleiman the Magnificent, the Ottoman Empire marked the peak of its power and prosperity as well as the highest development of its government, social, and economic systems.[22] At the beginning of the 17th century, the empire contained 32 provinces and numerous vassal states. Some of these were later absorbed into the Ottoman Empire, while others were granted various types of autonomy over the course of centuries.With Constantinople (modern-day Istanbul) as its capital and control of lands around the Mediterranean Basin, the Ottoman Empire was at the centre of interactions between the Eastern and Western worlds for six centuries. While the empire was once thought to have entered a period of decline following the death of Suleiman the Magnificent, this view is no longer supported by the majority of academic historians.The empire continued to maintain a flexible and strong economy, society and military throughout the 17th and for much of the 18th century. However, during a long period of peace from 1740 to 1768, the Ottoman military system fell behind that of their European rivals, the Habsburg and Russian empires.[25] The Ottomans consequently suffered severe military defeats in the late 18th and early 19th centuries. The successful Greek War of Independence concluded with decolonization following the London Protocol (1830) and Treaty of Constantinople (1832). This and other defeats prompted them to initiate a comprehensive process of reform and modernisation known as the Tanzimat. Thus, over the course of the 19th century, the Ottoman state became vastly more powerful and organised, despite suffering further territorial losses, especially in the Balkans, where a number of new states emerged.The Committee of Union and Progress (CUP) established the Second Constitutional Era in the Young Turk Revolution in 1908, turning the Empire into a constitutional monarchy which conducted competitive multi-party elections. A few years later, the now radicalized and nationalistic Union and Progress Party took over the government in the 1913 coup d'état, creating a one party regime. The CUP allied the Empire with Germany hoping to escape from the diplomatic isolation which had contributed to its recent territorial losses, and thus joined World War I on the side of the Central Powers. While the Empire was able to largely hold its own during the conflict, it was struggling with internal dissent, especially with the Arab Revolt in its Arabian holdings. During this time, genocide was committed by the Ottoman government against the Armenians, Assyrians, and Greeks.[28] The Empire's defeat and the occupation of part of its territory by the Allied Powers in the aftermath of World War I resulted in its partitioning and the loss of its Middle Eastern territories, which were divided between the United Kingdom and France. The successful Turkish War of Independence led by Mustafa Kemal Atatürk against the occupying Allies led to the emergence of the Republic of Turkey in the Anatolian heartland and the abolition of the Ottoman monarchy. ",
    term_type: "localization",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/c/c7/Coat_of_arms_of_the_Ottoman_Empire_%281882%E2%80%931922%29.svg/125px-Coat_of_arms_of_the_Ottoman_Empire_%281882%E2%80%931922%29.svg.png",
    latitude: 41.0,
    longitude: 29.0,
    date: 1299,
    on_timeline: true,
    relates: [],
  },
  {
    id: 9,
    title: "Spanish Inquisition",
    description:
      "The Tribunal of the Holy Office of the Inquisition (Spanish: Tribunal del Santo Oficio de la Inquisición), commonly known as the Spanish Inquisition (Spanish: Inquisición española), was established in 1478 by Catholic Monarchs, King Ferdinand II of Aragon and Queen Isabella I of Castile. It was intended to maintain Catholic orthodoxy in their kingdoms and to replace the Medieval Inquisition, which was under Papal control. It became the most substantive of the three different manifestations of the wider Catholic Inquisition along with the Roman Inquisition and Portuguese Inquisition. The 'Spanish Inquisition' may be defined broadly, operating in Spain and in all Spanish colonies and territories, which included the Canary Islands, the Kingdom of Naples,[citation needed] and all Spanish possessions in North, Central, and South America. According to modern estimates, around 150,000 people were prosecuted for various offenses during the three-century duration of the Spanish Inquisition, of which between 3,000 and 5,000 were executed (~2.7% of all cases).[1]The Inquisition was originally intended primarily to identify heretics among those who converted from Judaism and Islam to Catholicism. The regulation of the faith of newly converted Catholics was intensified after the royal decrees issued in 1492 and 1502 ordering Muslims and Jews to convert to Catholicism or leave Castile.[2] The Inquisition was not definitively abolished until 1834, during the reign of Isabella II, after a period of declining influence in the preceding century.",
    term_type: "event",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/9/90/Inquisici%C3%B3n_espa%C3%B1ola.svg/170px-Inquisici%C3%B3n_espa%C3%B1ola.svg.png",
    latitude: 32.166667,
    longitude: 35.283333,
    date: 1480,
    on_timeline: true,
  },
  {
    id: 10,
    title: "Teachings of Martin Luther",
    description:
      "Martin Luther, OSA (/ˈluːθər/;[1] German: [ˈmaʁtiːn ˈlʊtɐ] (About this soundlisten); 10 November 1483[2] – 18 February 1546) was a German professor of theology, priest, author, composer, Augustinian monk,[3] and a seminal figure in the Reformation. Luther was ordained to the priesthood in 1507. He came to reject several teachings and practices of the Roman Catholic Church; in particular, he disputed the view on indulgences. Luther proposed an academic discussion of the practice and efficacy of indulgences in his Ninety-five Theses of 1517. His refusal to renounce all of his writings at the demand of Pope Leo X in 1520 and the Holy Roman Emperor Charles V at the Diet of Worms in 1521 resulted in his excommunication by the pope and condemnation as an outlaw by the Holy Roman Emperor.Luther taught that salvation and, consequently, eternal life are not earned by good deeds but are received only as the free gift of God's grace through the believer's faith in Jesus Christ as redeemer from sin. His theology challenged the authority and office of the pope by teaching that the Bible is the only source of divinely revealed knowledge,[4] and opposed sacerdotalism by considering all baptized Christians to be a holy priesthood.[5] Those who identify with these, and all of Luther's wider teachings, are called Lutherans, though Luther insisted on Christian or Evangelical (German: evangelisch) as the only acceptable names for individuals who professed Christ. His translation of the Bible into the German vernacular (instead of Latin) made it more accessible to the laity, an event that had a tremendous impact on both the church and German culture. It fostered the development of a standard version of the German language, added several principles to the art of translation,[6] and influenced the writing of an English translation, the Tyndale Bible.[7] His hymns influenced the development of singing in Protestant churches.[8] His marriage to Katharina von Bora, a former nun, set a model for the practice of clerical marriage, allowing Protestant clergy to marry.[9]In two of his later works, Luther expressed antagonistic, violent views towards Jews and called for the burnings of their synagogues and their deaths.[10] His rhetoric was not directed at Jews alone but also towards Roman Catholics, Anabaptists, and nontrinitarian Christians.[11] Luther died in 1546 with Pope Leo X's excommunication still in effect. ",
    term_type: "person",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/9/90/Lucas_Cranach_d.%C3%84._-_Martin_Luther%2C_1528_%28Veste_Coburg%29.jpg/220px-Lucas_Cranach_d.%C3%84._-_Martin_Luther%2C_1528_%28Veste_Coburg%29.jpg",
    latitude: 51.516667,
    longitude: 11.55,
    date: 1489,
    on_timeline: false,
  },

  {
    id: 11,
    title: "Jesus",
    description:
      "Jesus (Greek: Ἰησοῦς, romanized: Iēsoûs, likely from Hebrew/Aramaic: יֵשׁוּעַ‎, romanized: Yēšūaʿ; c. 4 BC – AD 30 / 33) also referred to as Jesus of Nazareth or Jesus Christ,[e] was a first-century Jewish preacher and religious leader.[11] He is the central figure of Christianity, the world's largest religion. Most Christians believe he is the incarnation of God the Son and the awaited messiah (the Christ), prophesied in the Old Testament.[12][13]Virtually all modern scholars of antiquity agree that Jesus existed historically,[f] although the quest for the historical Jesus has yielded some uncertainty on the historical reliability of the Gospels and on how closely the Jesus portrayed in the Bible reflects the historical Jesus, as the only records of Jesus' life are contained in the Gospels.[21][g][h] Jesus was a Galilean Jew,[11] who was baptized by John the Baptist and began his own ministry. His teachings were initially conserved by oral transmission[24] and he himself was often referred to as 'rabbi'.[25] Jesus debated with fellow Jews on how to best follow God, engaged in healings, taught in parables and gathered followers.[26][27] Tradition holds that he was arrested and tried by the Jewish authorities,[28] turned over to the Roman government, and crucified on the order of Pontius Pilate, the Roman prefect.[26] After his death, his followers believed he rose from the dead, and the community they formed eventually became the early Church.[29]",
    term_type: "person",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/4/4a/Spas_vsederzhitel_sinay.jpg/321px-Spas_vsederzhitel_sinay.jpg",
    relates: [12, 13, 19],
    start_date: -4,
    end_date: 33,
  },
  {
    id: 12,
    title: "Judah",
    description:
      "Jude (alternatively Judas or Judah; Greek: Ἰούδας) is one of the brothers of Jesus (Greek: ἀδελφοί, romanized: adelphoi, lit. 'brethren')[1][2] according to the New Testament. He is traditionally identified as the author of the Epistle of Jude, a short epistle which is reckoned among the seven general epistles of the New Testament—placed after Paul's epistles and before the Book of Revelation—and considered canonical by Christians.[3][4] Catholics and Eastern Orthodox Christians believe this Jude is the same person as Jude the Apostle and that Jude was perhaps a cousin, but not literally a brother of Jesus, or perhaps St. Joseph’s son from a previous marriage.[5]",
    term_type: "person",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/9/96/Bloch-SermonOnTheMount.jpg/120px-Bloch-SermonOnTheMount.jpg",
    relates: [11],
    start_date: 2,
    end_date: 35,
  },
  {
    id: 13,
    title: "Saint Peter",
    description:
      "Saint Peter[5] (died between AD 64 and 68[1]), also known as Simon Peter, Simeon, Simon (/ˈsaɪmən/ (About this soundlisten)), Cephas (/ˈsiːfəs/[6]), or Peter the Apostle, was one of the Twelve Apostles of Jesus Christ, and one of the first leaders of the early Church.According to Christian tradition, Peter was crucified in Rome under Emperor Nero. He is traditionally counted as the first bishop of Rome‍—‌or pope‍—‌and also by Eastern Christian tradition as the first patriarch of Antioch. The ancient Christian churches all venerate Peter as a major saint and as the founder of the Church of Antioch and the Diocese of Rome,[1] but differ in their attitudes regarding the authority of his successors. According to Catholic teaching, Jesus promised Peter a special position in the Church.[7]",
    term_type: "person",
    relates: [],
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/2/2d/Pope-peter_pprubens.jpg/220px-Pope-peter_pprubens.jpg",
    start_date: 1,
    end_date: 66,
  },
  {
    id: 14,
    title: "Mark the Evangelist",
    description:
      "Mark the Evangelist (Latin: Marcus; Greek: Μᾶρκος, romanized: Mârkos; Aramaic: ܡܪܩܘܣ Marqōs) is the traditionally ascribed author of the Gospel of Mark. Mark is said to have founded the Church of Alexandria, one of the most important episcopal sees of early Christianity. His feast day is celebrated on April 25, and his symbol is the winged lion.[3]",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/8/83/Grandes_Heures_Anne_de_Bretagne_Saint_Matthieu.jpg/395px-Grandes_Heures_Anne_de_Bretagne_Saint_Matthieu.jpg",
    term_type: "person",
    relates: [],
    start_date: 5,
    end_date: 68,
  },
  {
    id: 15,
    title: "Saint Joseph",
    description:
      "Joseph (Hebrew: יוֹסֵף‎, romanized: Yosef; Greek: Ἰωσήφ, romanized: Ioséph) was a 1st-century man of Nazareth who, according to the canonical Gospels, was married to Mary, the mother of Jesus, and was the legal father of Jesus.[1]The Gospels also name some brothers of Jesus,[2] who may also have been Joseph's sons; the Gospel of James, an apocryphal work of the late 2nd century, theorized these as the sons of Joseph from an earlier marriage. This position is still held in the Orthodox churches, but the Western church holds to Jerome's argument that both Joseph and Mary must have been lifelong virgins and that the 'brothers' must have been his cousins. Perspectives on Joseph as a historical figure are distinguished from a theological reading of the Gospel texts.[3]",
    term_type: "person",
    relates: [20],
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Guido_Reni_-_St_Joseph_with_the_Infant_Jesus_-_WGA19304.jpg/491px-Guido_Reni_-_St_Joseph_with_the_Infant_Jesus_-_WGA19304.jpg",
    start_date: -100,
    end_date: 1,
  },

  {
    id: 16,
    title: "Chezib of Judah",
    description:
      "Chezib, also known as Achziv of Judah (Hebrew: אכזיב; כזיב‎), is a biblical place-name associated with the birth of Judah's son, Shelah (Genesis 38:5), corresponding to the Achziv of the Book of Joshua (15:44), a town located in the low-lying hills of the plain of Judah, known as the Shefela. In I Chronicles 4:22, the town is rendered as Chozeba. The place is now a ruin.",
    term_type: "place",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/2/29/Stone_wall_at_Chezib.jpg/220px-Stone_wall_at_Chezib.jpg",
    relates: [11, 13, 14],
    latitude: 31.683333,
    longitude: 35.016944,
  },
  {
    id: 17,
    title: "Gath",
    description:
      "Gath or Gat (Biblical Hebrew: גַּת‎ – Gaṯ, wine press; Latin: Geth), often referred to as Gath of the Philistines, was one of the five Philistine city-states, established in northeastern Philistia. Gath is often mentioned in the Hebrew Bible and its existence is confirmed by Egyptian inscriptions.Gath is mentioned in the El-Amarna letters as Gimti/Gintu, ruled by the two Shuwardata and ʿAbdi-Ashtarti.[1][2][citation needed] Another Gath, known as Ginti-kirmil (Gath of Carmel) also appears in the Amarna letters.[3]The site most favored as the location of Gath is the archaeological mound or tell known as Tell es-Safi in Arabic and Tel Zafit in Hebrew (sometimes written Tel Tzafit), located inside Tel Zafit National Park,[4] but a stone inscription disclosing the name of the city has yet to be discovered. Recent excavations at the site have produced dramatic evidence of a siege and subsequent destruction of the site in the late 9th century BCE, which can be related to the biblical verse that mentions its capture by Hazael of Aram Damascus.",
    term_type: "place",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Cafit030.jpg/300px-Cafit030.jpg",
    relates: [16, 14, 15],
    latitude: 31.7,
    longitude: 34.847,
  },
  {
    id: 18,
    title: "Tel Jezreel",
    description:
      "Tel Jezreel (Hebrew: יִזְרְעֶאל‬‎ Yizrəʽel, 'God will sow') is an archaeological site in the eastern Jezreel Valley in northern Israel. The city of Jezreel served as a main fortress of the Kingdom of Israel under king Ahab in the 9th century BCE.",
    term_type: "place",
    image:
      "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dc/TelIzrael006.jpg/220px-TelIzrael006.jpg",
    latitude: 32.557853,
    longitude: 35.327953,
  },
  {
    id: 19,
    title: "The Passion",
    description:
      "Donec blandit, eros ut congue volutpat, sapien nisl commodo lectus, eget malesuada urna dui nec justo. Vivamus in tincidunt sapien, nec bibendum lacus. Fusce vitae dignissim elit. Nunc a congue massa. Mauris maximus quis neque eu malesuada. Quisque nec elementum mauris, nec iaculis urna. Proin lobortis ipsum dui, in dignissim leo tincidunt sed. Etiam vel ante sed orci sodales laoreet vitae vel eros. Sed interdum tristique odio a condimentum.Aenean hendrerit sem sed turpis dapibus, a ultrices ex molestie. Mauris id turpis nec velit facilisis ultricies id ut leo. Ut eleifend leo eget justo dignissim, vitae aliquet leo cursus. Aenean at purus mattis nibh suscipit maximus. Maecenas dapibus urna ac diam semper, quis finibus nisi posuere. Duis ornare a velit non luctus. Donec a volutpat libero. Nunc gravida odio in tellus interdum, quis scelerisque orci tempus.Fusce scelerisque mi quis efficitur consequat. Aenean efficitur bibendum rutrum. Sed vitae mauris tincidunt, fermentum elit quis, posuere mauris. Maecenas ac risus blandit, pretium orci in, tristique nunc. Praesent elementum facilisis risus, et faucibus quam ullamcorper vitae. Aenean bibendum orci quis purus semper convallis. Sed eget elit ut libero bibendum faucibus.",
    term_type: "topic",
    image: "",
    relates: [11, 13, 14],
    latitude: 31.683333,
    longitude: 35.016944,
  },
  {
    id: 20,
    title: "Death of Christ",
    description:
      "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin congue dolor non vulputate vehicula. Curabitur sodales leo non quam fermentum, sed sodales augue maximus. Etiam feugiat lectus at diam cursus bibendum. Pellentesque quis pellentesque lectus. Quisque a iaculis mi. Nullam eu nibh molestie, aliquam ligula sed, cursus ante. Nullam eros nisl, auctor sed mi a, tempus tristique nisi. Etiam ante eros, placerat id mauris consectetur, porttitor ultrices ipsum. Proin vitae suscipit massa. Vestibulum at iaculis orci. Proin volutpat mollis auctor. Fusce non semper felis. Quisque luctus cursus nisl, quis porttitor arcu porttitor vel. Cras ut leo malesuada, dapibus est sit amet, pulvinar nunc. Integer sed nibh eget quam sodales pellentesque et condimentum risus.In consectetur ex quis metus eleifend lacinia. Donec lacinia purus metus, nec semper sem tristique vel. Phasellus posuere purus neque, at varius magna mollis id. Vivamus a mauris sed mi vulputate dapibus eu eu eros. Proin eu risus eros. Donec nec elit et felis interdum pretium. Nullam sit amet tortor gravida, pulvinar ligula sit amet, sagittis mauris.",
    term_type: "topic",
    image: "",
    relates: [11, 14, 15],
    latitude: 31.7,
    longitude: 34.847,
  },
  {
    id: 21,
    title: "Scriptures",
    description:
      "In consectetur ex quis metus eleifend lacinia. Donec lacinia purus metus, nec semper sem tristique vel. Phasellus posuere purus neque, at varius magna mollis id. Vivamus a mauris sed mi vulputate dapibus eu eu eros. Proin eu risus eros. Donec nec elit et felis interdum pretium. Nullam sit amet tortor gravida, pulvinar ligula sit amet, sagittis mauris.Donec blandit, eros ut congue volutpat, sapien nisl commodo lectus, eget malesuada urna dui nec justo. Vivamus in tincidunt sapien, nec bibendum lacus. Fusce vitae dignissim elit. Nunc a congue massa. Mauris maximus quis neque eu malesuada. Quisque nec elementum mauris, nec iaculis urna. Proin lobortis ipsum dui, in dignissim leo tincidunt sed. Etiam vel ante sed orci sodales laoreet vitae vel eros. Sed interdum tristique odio a condimentum.Aenean hendrerit sem sed turpis dapibus, a ultrices ex molestie. Mauris id turpis nec velit facilisis ultricies id ut leo. Ut eleifend leo eget justo dignissim, vitae aliquet leo cursus. Aenean at purus mattis nibh suscipit maximus. Maecenas dapibus urna ac diam semper, quis finibus nisi posuere. Duis ornare a velit non luctus. Donec a volutpat libero. Nunc gravida odio in tellus interdum, quis scelerisque orci tempus.",
    term_type: "topic",
    image: "",
    latitude: 32.557853,
    longitude: 35.327953,
  },
];

let dataFromApi;

// -----------------------------------------------------------------------------------------
// ------------------------------------Query-Selector-Elements------------------------------
// -----------------------------------------------------------------------------------------

const line = document.querySelector(".line");
const lineInner = document.querySelector(".line-inner");
const lineBefore = document.querySelector(".line-before");
const lineAfter = document.querySelector(".line-after");
const yearTimeline = document.querySelector(".year-timeline");
const timelineWidth = line.offsetWidth;
const innerTimeline = document.querySelector(".timeline-inner");
const timeLineContainer = document.querySelector(".timeline-container");
let btns;

// ------------Sliding Header--------------------------
const slidingHeader = document.querySelector(".sliding-header");
const headingTitle = document.querySelector(".sliding-header h2");
const headingText = document.querySelector(".sliding-header p");
const slidingHeaderUp = document.querySelector(".sliding-header.up");

// ------------Sliding Sidepanel-----------------------
const slidingPanel = document.querySelector(".slidingPanel");
const slidingPanelHeader = document.querySelector(".slidingPanel h2");
const slidingPanelButtons = document.querySelector(".buttons");
const slidingPanelText = document.querySelector(".text");
const relatedDiv = document.querySelector(".related");
const relatedBtnContainer = document.querySelector(".relatedBtns");
const prevArrowBtn = document.querySelector(".prevArrowBtn");

const showLayerBtn = document.querySelector(".showLayer");
const setRoute = document.querySelector(".setRoute");

let zoomLevel = 3;

// -----------------------------------------------------------------------------------------
// --------------------------------------Fetch-Data-From-Django-API-------------------------
// -----------------------------------------------------------------------------------------

const dots = document.querySelector(".dots");
const infoText = document.querySelector(".info");
const framePointer = document.querySelector(".frame-pointer");
const frame = document.querySelector(".frame");
async function fetchData() {
  try {
    const response = await fetch(
      "https://cretio.atechno.pl/data/terms/?format=json"
    );

    const fetchedData = await response.json();
    console.log(fetchedData.length);
    if (fetchedData.length !== 0) {
      setTimeout(() => {
        const isOnTimelineData = fetchedData.filter(
          (item) => item.is_in_main_timeline
        );

        const yearsOnTimeline = fetchedData
          .filter((item) => item.is_in_main_timeline)
          .map((item) => {
            const [date] = item.date;
            const { start_year } = date;
            return start_year;
          })
          .sort((a, b) => a - b);

        const rangeOfYears = generateRangeOfYears(fetchedData);

        dataFromApi = isOnTimelineData;
        // console.log(yearsOnTimeline);
        addYearsToTimeline(
          rangeOfYears,
          fetchedData,
          detectDuplicates(yearsOnTimeline)
        );

        setWidthOnMainTimeline();
        createYearBtns(isOnTimelineData, yearsOnTimeline);
        dots.style.display = "none";
        framePointer.style.display = "block";
        frame.style.display = "block";
        lineAfter.style.opacity = "100";
        lineBefore.style.opacity = "100";
        btns = document.querySelectorAll(".btn");
        btns.forEach((btn) => {
          btn.addEventListener("mouseup", (e) => {
            e.preventDefault();
            centerButton(btn);
          });
        });
        btns.forEach((btn) => {
          if (btn.getAttribute("title") === "-4") {
            centerButton(btn);
            markerOpen(btn.id);
          }
        });
      }, 500);
    } else if (fetchedData.length === 0) {
      setTimeout(() => {
        dots.style.display = "none";
        infoText.style.display = "block";
      }, 500);
    }
  } catch (error) {
    console.log(error);
    infoText.style.display = "block";
  }
}

fetchData();

// ------------------------------------------------------------------------------------
// --------------------------Generate-range-of-years-from-fetch-data-------------------
// ------------------------------------------------------------------------------------

function generateRangeOfYears(data) {
  const yearsOnTimeline = data
    .filter((item) => item.is_in_main_timeline)
    .map((item) => {
      const [date] = item.date;
      const { start_year } = date;
      return start_year;
    })
    .sort((a, b) => a - b);
  // console.log(yearsOnTimeline);
  // console.log(data);
  const minYear = Math.min(...yearsOnTimeline);
  const maxYear = Math.max(...yearsOnTimeline);
  const rangeOfYears = range(
    minYear,
    maxYear,
    10,
    detectDuplicates(yearsOnTimeline)
  );
  return rangeOfYears;
}

// ------------------------------------------------------------------------------------
// ----------------------------Detect duplicates---------------------------------------
// ------------------------------------------------------------------------------------

function detectDuplicates(yearsOnTimeline) {
  let duplicates = [];
  yearsOnTimeline.forEach((item, index) => {
    if (yearsOnTimeline[index - 1]) {
      if (Math.abs(yearsOnTimeline[index - 1] - item) === 0) {
        duplicates.push(item);
      }
    }
  });
  duplicates = [...new Set(duplicates)];

  return duplicates;
}

// ------------------------------------------------------------------------------------
// ----------------------------Add-years-to-timeline-----------------------------------
// ------------------------------------------------------------------------------------

function addYearsToTimeline(rangeOfYears, data, duplicates) {
  const yearsOnTimeline = data
    .filter((item) => item.is_in_main_timeline)
    .map((item) => {
      const [date] = item.date;
      const { start_year } = date;
      return start_year;
    })
    .sort((a, b) => a - b);
  // console.log(rangeOfYears);
  yearTimeline.innerHTML = "";
  rangeOfYears.forEach((year, index) => {
    let lowerYears = [];
    let higherYears = [];

    yearsOnTimeline.forEach((item, index) => {
      let closestLowerYear = Math.max(
        ...rangeOfYears.filter((num) => num <= item)
      );

      let closestHigherYear = Math.min(
        ...rangeOfYears.filter((num) => num > item)
      );

      // console.log(`for ${item} the closesthigheryear is${closestHigherYear}`);
      // console.log(`for number ${item} the lower value is ${closestLowerYear}`);
      if (closestLowerYear === year) {
        lowerYears.push(year);
      }
      if (yearsOnTimeline[index - 1]) {
        if (Math.abs(yearsOnTimeline[index - 1] - item) < 5) {
          if (closestHigherYear === year) {
            // console.log(
            //   `${yearsOnTimeline[index - 1]}, ${item} = ${Math.abs(
            //     yearsOnTimeline[index - 1] - item
            //   )}`
            // );
            higherYears.push(year);
          }
        }
      }
    });
    // console.log(items.length);
    // console.log(
    //   "-------------------------------------------------------------------------"
    // );
    // console.log(lowerYears);

    if (
      lowerYears.length !== 0 ||
      higherYears.length !== 0 ||
      index === rangeOfYears.length - 1
    ) {
      const span = document.createElement("span");
      span.classList.add("year-label");
      span.innerHTML = `<time class="time">${year}</time>`;

      span.style.width = `${zoomLevel * 80}px`;
      // change length of span depends on quantity of years
      // + (lowerYears.length > 1 ? lowerYears.length * 50 : 0)
      yearTimeline.appendChild(span);
    }
    // index === yearsOnTimeline.length - 1
  });
}

// ------------------------------------------------------------------------------------
// ---------------------------Set-width-on-main-timeline-------------------------------
// ------------------------------------------------------------------------------------

function setWidthOnMainTimeline() {
  lineInner.style.width = yearTimeline.offsetWidth + "px";
  innerTimeline.style.width =
    yearTimeline.offsetWidth +
    lineBefore.getBoundingClientRect().width +
    lineAfter.getBoundingClientRect().width +
    "px";
}

// ------------------------------------------------------------------------------------
// ----------------------------------generate-range------------------------------------
// ------------------------------------------------------------------------------------

const range = (minYear, maxYear, numRange, duplicates) => {
  let range = [];
  range.push(maxYear);
  for (let i = minYear; i < maxYear; i += numRange) {
    range.push(i);
  }

  let maxWithRange = maxYear + numRange;
  console.log(maxWithRange);
  range.push(maxWithRange);
  duplicates.forEach((item) => {
    if (item !== minYear) {
      range.push(item);
      range.push(item + 1);
    } else {
      range.push(item + 1);
    }
  });
  range = [...new Set(range)];
  // console.log(range);
  range.sort((a, b) => a - b);

  return range;
};

// ------------------------------------------------------------------------------------
// -----------------------scale-one-number-range-to-another-range----------------------
// ------------------------------------------------------------------------------------

const scale = (num, in_min, in_max, out_min, out_max) => {
  return ((num - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min;
};

// ------------------------------------------------------------------------------------
// -----------------------------create-yearBtns-on-maintimeline------------------------
// ------------------------------------------------------------------------------------
function createYearBtns(timelineData) {
  const mainYears = document.querySelectorAll(".year-label");

  const mainYearsNum = [...mainYears].map((item) => {
    return +item.innerText;
  });
  console.log(mainYearsNum);
  console.log(mainYearsNum[mainYearsNum.length - 1]);
  // console.log(timelineData);
  const sortedData = timelineData.slice(0).sort((a, b) => {
    return a.date[0].start_year - b.date[0].start_year;
  });
  let counter = 0;
  console.log(sortedData);
  sortedData.forEach((item, index) => {
    const [dateObject] = item.date;
    const { start_year } = dateObject;
    const highestYear = mainYearsNum.find((elem) => elem > start_year)
      ? mainYearsNum.find((elem) => elem > start_year)
      : mainYearsNum.find((elem) => elem >= start_year);

    const lowerYear = mainYearsNum[mainYearsNum.indexOf(highestYear) - 1];

    // if (sortedData[index - 1]) {
    //   if (
    //     Math.abs(
    //       sortedData[index - 1].date[0].start_year -
    //         sortedData[index].date[0].start_year
    //     ) < 10 &&
    //     Math.abs(lowerYear - highestYear) > 10
    //   ) {
    //     console.log(`${sortedData[index].date[0].start_year} jest mniejsze`);
    //     const dataSpan = [...mainYears].filter((elem) => {
    //       if (+elem.children[0].innerText === lowerYear) {
    //         return item.date;
    //       }
    //     })[0];
    //     dataSpan.style.width = `${dataSpan.offsetWidth + 100}px`;
    //     console.log(dataSpan.offsetWidth);
    //   }
    // }

    const lowYear = [...mainYears].filter((elem) => {
      if (+elem.children[0].innerText === lowerYear) {
        return item.date;
      }
    })[0].children[0];

    const highYear = [...mainYears].filter((elem) => {
      if (+elem.children[0].innerText === highestYear) {
        return item.date;
      }
    })[0].children[0];

    // console.log(highYear);

    const lowRangePosition =
      lowYear.offsetLeft + lowYear.getBoundingClientRect().width / 2;
    const highRangePosition =
      highYear.offsetLeft + highYear.getBoundingClientRect().width / 2;

    // more than one item in section

    const btn = document.createElement("button");
    btn.id = `${item.id}`;
    btn.classList.add("btn", "btn-4");
    btn.setAttribute("title", start_year);

    if (sortedData[index - 1]) {
      const [prevDataObject] = sortedData[index - 1].date;
      const { start_year: prevStartYear } = prevDataObject;
      if (prevStartYear !== start_year) {
        counter = 0;
        btn.style.left = `${scale(
          start_year,
          lowerYear,
          highestYear,
          lowRangePosition,
          highRangePosition
        )}px`;
      } else {
        counter++;
        btn.style.left = `${
          scale(
            start_year,
            lowerYear,
            highestYear,
            lowRangePosition,
            highRangePosition
          ) +
          counter * 50
        }px`;
      }
    } else {
      btn.style.left = `${scale(
        start_year,
        lowerYear,
        highestYear,
        lowRangePosition,
        highRangePosition
      )}px`;
    }

    lineInner.appendChild(btn);
  });
}
// ------------------------------------------------------------------------------------
// ------------------------------------------------------------------------------------
// ------------------------------------------------------------------------------------

const generateYears = data
  .filter((item) => item.on_timeline)
  .map((item) => item.date);
const minYear = Math.min(...generateYears);
const maxYear = Math.max(...generateYears);

// const years = range(minYear, maxYear, 50);

const isOnTimelineData = data.filter((item) => item.on_timeline);

// const characters = data.filter((item) => item.term_type === "person");

// const place = data.filter((item) => item.term_type === "place");

// const yearsFromData = data
//   .map((item) => {
//     return item.date;
//   })
//   .filter((item) => item);

// console.log(isOnTimelineData);
// console.log(yearsFromData);

// ------------------------------------------------------------------------------------------------------
// ------------------------------------------------------------------------------------------------------
// ------------------------------------------------------------------------------------------------------

// years.forEach((year) => {
//   const span = document.createElement("span");
//   span.classList.add("year-label");
//   span.innerHTML = `<time class="time">${year}</time>`;
//   span.style.width = `${zoomLevel * 150}px`;
//   yearTimeline.appendChild(span);
// });
//

// ------------------------------------------------------------
// --------------dynamic-add-width-to-timeline-----------------
// ------------------------------------------------------------

// lineInner.style.width = yearTimeline.offsetWidth + "px";
// innerTimeline.style.width =
//   yearTimeline.offsetWidth +
//   lineBefore.getBoundingClientRect().width +
//   lineAfter.getBoundingClientRect().width +
//   "px";

// -----------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------

// isOnTimelineData.forEach((item) => {
//   const highestYear = years.find((elem) => elem > item.date);
//   const lowerYear = years[years.indexOf(highestYear) - 1];

//   const lowYear = [...mainYears].filter((elem) => {
//     if (+elem.children[0].innerText === lowerYear) {
//       return item.date;
//     }
//   })[0].children[0];
//   // console.log(lowYear);

//   const highYear = [...mainYears].filter((elem) => {
//     if (+elem.children[0].innerText === highestYear) {
//       return item.date;
//     }
//   })[0].children[0];

//   const lowRangePosition =
//     lowYear.offsetLeft + lowYear.getBoundingClientRect().width / 2;
//   const highRangePosition =
//     highYear.offsetLeft + highYear.getBoundingClientRect().width / 2;
//   // console.log(highYear);

//   const btn = document.createElement("button");
//   btn.id = `${item.id}`;
//   btn.classList.add("btn", "btn-4");
//   btn.setAttribute("title", item.date);
//   btn.style.left = `${scale(
//     item.date,
//     lowerYear,
//     highestYear,
//     lowRangePosition,
//     highRangePosition
//   )}px`;

//   lineInner.appendChild(btn);
// });

// -------------------------------------------------------------------------------
// -------------------------------------------------------------------------------
// -------------------------------------------------------------------------------

const timeline = document.querySelector(".timeline");
const times = document.querySelectorAll(".time");
const windowCenter = window.innerWidth / 2;

const mapContainer = document.querySelector(
  ".map-container:not(.sliding-header)"
);
// updateYear();

// btns.forEach((btn) => {
//   btn.addEventListener("mouseup", (e) => {
//     e.preventDefault();
//     centerButton(btn);
//   });
// });

mapContainer.style.height = `calc(100vh - ${timeLineContainer.offsetHeight}px)`;

// ----------------------VARIABLES--------------------------

let currentBtn;
let mainSubject;
let isActive = false;
let isMoved = false;
let pressed = false;
let prevBtn;
let startX;
let x;
let sidePanelContainer;
let isPrevBtn = false;

// Mousedown/touchstart--------

timeline.addEventListener("mousedown", (e) => {
  pressed = true;
  startX = e.offsetX - innerTimeline.offsetLeft;
  timeline.style.cursor = "grabbing";
});

// Mouseenter-on-grab----------

timeline.addEventListener("mouseenter", () => {
  timeline.style.cursor = "grab";
});

// Mouseup/touchend-------------

timeline.addEventListener("mouseup", () => {
  pressed = false;
  timeline.style.cursor = "grab";

  getClosestButton();
});

// Mousemove/touchmove---------

timeline.addEventListener("mousemove", (e) => {
  moveTimeline(e);
});
timeline.addEventListener("mouseleave", (e) => {
  pressed = false;
});

// --------------------------------------------------------
// --------------------MOVE-TIMELINE-----------------------
// --------------------------------------------------------

// Mousemove-----------------------------------------------

function moveTimeline(e) {
  if (!pressed) return;
  isActive = false;
  innerTimeline.style.transition = "none";
  e.preventDefault();
  x = e.offsetX;
  innerTimeline.style.left = `${x - startX}px`;
  checkBoundry();
  checkBtnCenter();
  updateYear();
  setBottom();
  slidingHeader.classList.remove("up");
  slidingHeader.classList.remove("up-1");
  slidingHeader.classList.remove("up-2");
  slidingHeader.classList.remove("up-3");
}

// --------------------------------------------------------
// ----------CHECK-IF-TIMELINE-IS-ON-THE-BOUNDRY-----------
// --------------------------------------------------------

function checkBoundry() {
  let outer = timeline.getBoundingClientRect();
  let inner = innerTimeline.getBoundingClientRect();

  if (parseInt(innerTimeline.style.left) > 0) {
    innerTimeline.style.left = "0px";
  } else if (inner.right < outer.right) {
    innerTimeline.style.left = `-${inner.width - outer.width}px`;
  }
}
checkBoundry();

// --------------------------------------------------------------------------------------
// -------CHECK-IF-BUTTON-IS-CLOSE-TO-THE-CENTER-POSITION-AND-ADD-ACTIVE-CLASS-----------
// --------------------------------------------------------------------------------------

function checkBtnCenter() {
  btns.forEach((btn) => {
    const btnPosition = btn.getBoundingClientRect();
    const windowCenter = window.innerWidth / 2;
    if (
      btnPosition.left <= windowCenter + 12 &&
      btnPosition.right >= windowCenter - 12
    ) {
      btn.classList.add("active");
    } else {
      btn.classList.remove("active");
    }
  });
}

// ---------------------------------------------------------------------------------------
// ---------------------------UPDATE-YEAR-IN-FRAME-WHILE-SLIDE----------------------------
// ---------------------------------------------------------------------------------------

function updateYear() {
  const times = document.querySelectorAll(".time");

  const leftRange = [...times].filter((time) => {
    if (time.getBoundingClientRect().left < windowCenter) {
      return time;
    }
  });

  // console.log(times);
  // console.log(...leftRange);

  const spanWidth =
    leftRange[leftRange.length - 1].parentElement.getBoundingClientRect().width;
  const spanLeft =
    leftRange[leftRange.length - 1].parentElement.getBoundingClientRect().left;
  if (!leftRange) {
    return;
  }
  const leftValue = +leftRange[leftRange.length - 1].innerHTML;
  let frameValue;
  let rightValue;
  const rightRange = times[leftRange.length];
  // console.log(rightRange);

  if (!rightRange) {
    frameValue = years[years.length - 1].innerHTML;
  } else {
    rightValue = +rightRange.innerHTML;
  }

  frameValue = Math.floor(
    scale(windowCenter, spanLeft, spanLeft + spanWidth, leftValue, rightValue)
  );

  frame.innerText = frameValue;
}

// ----------------------------------------------------------------
// ------------------UPDATE-YEAR-IN-FRAME-WHILE-CLICK--------------
// ----------------------------------------------------------------

function changeYear() {
  const nextYear = +currentBtn.getAttribute("title");
  const currentYear = +frame.innerText;

  animateValue(frame, currentYear, nextYear, 600);
}

function animateValue(obj, start, end, duration) {
  let startTimestamp = null;
  const step = (timestamp) => {
    if (!startTimestamp) startTimestamp = timestamp;
    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
    obj.innerHTML = Math.floor(progress * (end - start) + start);
    if (progress < 1) {
      window.requestAnimationFrame(step);
    }
  };
  window.requestAnimationFrame(step);
}

// ------------------------------------------------------
// --------------CENTER-BUTTON-MAIN-FUNCTION-------------
// ------------------------------------------------------

function centerButton(btn) {
  // console.log(btn);
  prevBtn = currentBtn;
  currentBtn = btn;
  //   isActive = false;
  const windowCenterX = window.innerWidth / 2;

  const btnStartX = btn.getBoundingClientRect();
  innerTimeline.style.transition = "left 0.8s ease";

  const btnPositionX = btnStartX.right - btnStartX.width / 2;

  btns.forEach((btn) => {
    btn.classList.remove("active");
    btn.disabled = false;
  });

  if (btnPositionX > windowCenterX) {
    let outer = timeline.getBoundingClientRect();
    let inner = innerTimeline.getBoundingClientRect();

    const distance = btnPositionX - windowCenterX;
    innerTimeline.style.left = `${
      inner.right - distance < outer.right
        ? `-${inner.width - outer.width}`
        : innerTimeline.offsetLeft - distance
    }px`;

    btn.classList.add("active");
    btn.disabled = true;
    isActive = true;
  } else if (btnPositionX < windowCenterX) {
    const distance = windowCenterX - btnPositionX;
    innerTimeline.style.left = `${
      innerTimeline.offsetLeft + distance > 0
        ? innerTimeline.offsetLeft
        : innerTimeline.offsetLeft + distance
    }px`;
    btns.forEach((btn) => {
      btn.classList.remove("active");
    });

    btn.classList.add("active");
    btn.disabled = true;
    isActive = true;
  }

  const [currentSubject] = dataFromApi.filter(
    (item) => item.id === +currentBtn.id
  );
  updateYear();
  changeYear();
  updateSidePanel();

  if (
    slidingHeader.classList.contains("up") ||
    slidingHeader.classList.contains("up-1") ||
    slidingHeader.classList.contains("up-2") ||
    slidingHeader.classList.contains("up-3")
  ) {
    slidingHeader.classList.remove("up");
    slidingHeader.classList.remove("up-1");
    slidingHeader.classList.remove("up-2");
    slidingHeader.classList.remove("up-3");
  }

  setBottom();
  setTimeout(updateText, 500);

  setTimeout(() => {
    slideCenterHeader(currentSubject);
  }, 500);
  // generateTimelines(currentSubject);
}

// ------------------------------------------------------
// -------------UPDATE-TEXT-IN-SLIDING-HEADER------------
// ------------------------------------------------------

function updateText() {
  if (prevBtn === currentBtn) {
    return;
  }

  const currentElem = dataFromApi.find((elem) => elem.id === +currentBtn.id);

  headingTitle.innerText = currentElem.title;
  headingText.innerText = `${currentElem.description
    .split(" ")
    .slice(0, 18)
    .join(" ")}...`;
}

// ----------------------------------------------------------------------------------------------
//------------------------------GET-CLOSEST-BUTTON-FUNCTION--------------------------------------
// ----------------------------------------------------------------------------------------------

function getClosestButton() {
  if (isActive) {
    return;
  }

  const windowCenterX = window.innerWidth / 2;

  const btnsArr = Array.from(btns);

  const rightBtns = btnsArr
    .filter((btn) => {
      const btnStartX = btn.getBoundingClientRect();
      const btnPositionX = btnStartX.right - btnStartX.width / 2;
      return btnPositionX > windowCenterX;
    })
    .sort((a, b) => {
      const btnAStartX = a.getBoundingClientRect();
      const btnBStartX = b.getBoundingClientRect();
      const btnAPositionX = btnAStartX.right - btnAStartX.width / 2;
      const btnBPositionX = btnBStartX.right - btnBStartX.width / 2;

      return btnAPositionX - btnBPositionX;
    });

  const leftBtns = btnsArr
    .filter((btn) => {
      const btnStartX = btn.getBoundingClientRect();
      const btnPositionX = btnStartX.right - btnStartX.width / 2;
      return btnPositionX < windowCenterX;
    })
    .sort((a, b) => {
      const btnAStartX = a.getBoundingClientRect();
      const btnBStartX = b.getBoundingClientRect();
      const btnAPositionX = btnAStartX.right - btnAStartX.width / 2;
      const btnBPositionX = btnBStartX.right - btnBStartX.width / 2;

      return btnBPositionX - btnAPositionX;
    });

  if (!rightBtns[0]) {
    centerButton(leftBtns[0]);
    markerOpen(leftBtns[0].id);
    return;
  }

  if (!leftBtns[0]) {
    centerButton(rightBtns[0]);
    markerOpen(rightBtns[0].id);
    return;
  }
  const rightButtonRect = rightBtns[0].getBoundingClientRect();
  const leftButtonRect = leftBtns[0].getBoundingClientRect();
  if (
    rightButtonRect.left - windowCenterX >
    windowCenterX - leftButtonRect.right
  ) {
    centerButton(leftBtns[0]);
    markerOpen(leftBtns[0].id);
  } else if (
    rightButtonRect.left - windowCenterX <
    windowCenterX - leftButtonRect.right
  ) {
    centerButton(rightBtns[0]);
    markerOpen(rightBtns[0].id);
  }
}

// ------------------------------------------------------------------------------------------
// --------------------UPDATE-DATA-IN-SIDE-PANEL-AFTER-CLICK-ON-HEADER-----------------------
// ------------------------------------------------------------------------------------------

slidingHeader.addEventListener("click", () => {
  if (
    slidingHeader.classList.contains("up") &&
    !slidingPanel.classList.contains("active")
  ) {
    slidingHeader.classList.remove("up");
    setBottom();
  } else {
    slidingHeader.classList.add("up");
  }
  isPrevBtn = false;
  checkIsTrue();

  slidingPanel.classList.add("active");
  mapContainer.classList.add("active");

  document.querySelector(".leaflet-left").classList.add("active");
  document.querySelector(".leaflet-top.leaflet-right").classList.add("active");
  document.querySelector(".prev").classList.add("active");
  showLayerBtn.classList.add("active");
  setRoute.classList.add("active");

  slidingPanelHeader.classList.remove("show");
  slidingPanelText.classList.remove("show");
  relatedDiv.classList.remove("show");

  // ---------------------------------------------------------------------------------------
  // ----------------------------Fade-in-Fade-out-effect------------------------------------
  // ---------------------------------------------------------------------------------------

  const [currentSubject] = dataFromApi.filter(
    (item) => item.id === +currentBtn.id
  );
  console.log(currentSubject);
  sidePanelContainer = currentSubject;
  console.log(sidePanelContainer);

  setTimeout(function () {
    relatedBtnContainer.innerHTML = "";
    slidingPanelHeader.innerText = currentSubject.title;
    slidingPanelText.innerText = currentSubject.description;
    relatedDiv.innerHTML = "";

    if (currentSubject.relates) {
      showRelated(currentSubject.relates);
    } else {
      relatedDiv.innerHTML = "";
    }

    slidingPanelHeader.classList.add("show");
    slidingPanelText.classList.add("show");
    relatedDiv.classList.add("show");
  }, 500);
});

//---------------------------------------------------------------------------
//------------Update-content-in-side-panel-after-move-timeline---------------
//---------------------------------------------------------------------------

function updateSidePanel() {
  const [currentSubject] = data.filter((item) => item.id === +currentBtn.id);
  // console.log(currentSubject);
  sidePanelContainer = currentSubject;
  // console.log(sidePanelContainer);

  slidingPanelHeader.classList.remove("show");
  slidingPanelText.classList.remove("show");
  relatedDiv.classList.remove("show");

  setTimeout(function () {
    relatedBtnContainer.innerHTML = "";
    relatedDiv.innerHTML = "";

    showDescriAndTimeline(currentSubject);

    if (currentSubject.relates) {
      showRelated(currentSubject.relates);
    } else {
      relatedDiv.innerHTML = "";
    }

    slidingPanelHeader.classList.add("show");
    slidingPanelText.classList.add("show");
    relatedDiv.classList.add("show");
  }, 500);
}

prevArrowBtn.addEventListener("click", () => {
  const [currentSubject] = data.filter((item) => item.id === +currentBtn.id);
  console.log(currentSubject);
  sidePanelContainer = currentSubject;
  console.log(sidePanelContainer);
  isPrevBtn = false;

  checkIsTrue();

  // setTimeout(function () {
  relatedBtnContainer.innerHTML = "";
  showDescriAndTimeline(currentSubject);

  relatedDiv.innerHTML = "";

  if (currentSubject.relates) {
    showRelated(currentSubject.relates);
  } else {
    relatedDiv.innerHTML = "";
  }

  slidingPanelHeader.classList.add("show");
  slidingPanelText.classList.add("show");
  relatedDiv.classList.add("show");
  // }, 500);
});

function showRelated(arr) {
  if (!arr) {
    return;
  }
  const relatesData = [];
  arr.forEach((item) => {
    const [object] = data.filter((i) => i.id === item);
    relatesData.push(object);
  });

  console.log(relatesData);

  // show term_type from relates
  const types = [...new Set(relatesData.map((item) => item.term_type))].sort();
  // console.log(types);

  types.forEach((type, index) => {
    const typeBtn = document.createElement("button");
    typeBtn.classList.add("relatedBtn");
    if (index === 0) {
      typeBtn.classList.add("active");
    }
    typeBtn.id = `${type}s`;
    typeBtn.innerHTML = `
          <i class="fas fa-${
            type === "person"
              ? "users"
              : type === "place"
              ? "map-marker"
              : "book"
          }"></i> ${
      type === "person" ? "Characters" : type === "place" ? "Places" : "Topics"
    }
    `;
    relatedBtnContainer.appendChild(typeBtn);

    if (index === 0 && type === "person") {
      const characters = relatesData.filter(
        (item) => item.term_type === "person"
      );
      createRelated(characters, relatedDiv);
    }

    if (index === 0 && type === "place") {
      const places = relatesData.filter((item) => item.term_type === "place");
      createRelated(places, relatedDiv);
    }
    if (index === 0 && type === "topic") {
      const topics = relatesData.filter((item) => item.term_type === "topic");
      createRelated(topics, relatedDiv);
    }

    typeBtn.addEventListener("click", () => {
      document
        .querySelectorAll(".relatedBtn")
        .forEach((btn) => btn.classList.remove("active"));
      typeBtn.classList.add("active");
      console.log(typeBtn.innerText);

      if (typeBtn.innerText === "Characters") {
        relatedDiv.innerHTML = "";
        const characters = relatesData.filter(
          (item) => item.term_type === "person"
        );
        createRelated(characters, relatedDiv);
      }
      if (typeBtn.innerText === "Places") {
        relatedDiv.innerHTML = "";
        const places = relatesData.filter((item) => item.term_type === "place");
        createRelated(places, relatedDiv);
      }
      if (typeBtn.innerText === "Topics") {
        relatedDiv.innerHTML = "";
        const topics = relatesData.filter((item) => item.term_type === "topic");
        createRelated(topics, relatedDiv);
      }
    });
  });
}

function createRelated(arr, dest) {
  arr.forEach((item, index) => {
    // ----------------------------------------------------------------

    const elem = document.createElement("div");
    elem.id = item.id;

    elem.classList.add("person");
    elem.innerHTML = `
      <img
          src="${item.image}" 
          onerror="this.onerror=null;this.src='https://www.kenyons.com/wp-content/uploads/2017/04/default-image-620x600.jpg';"
          alt="${item.title}"
        />
        <p class="person-name">${item.title}</p>
      `;
    dest.appendChild(elem);
    elem.addEventListener("click", () => {
      removeHighLightTimeline();
      console.log(item.id);
      isPrevBtn = true;
      checkIsTrue();

      const [relatedBtnData] = data.filter((i) => i.id === item.id);

      sidePanelContainer = relatedBtnData;
      // showRelated(sidePanelContainer.relates);
      console.log(sidePanelContainer);

      // setTimeout(function () {
      relatedBtnContainer.innerHTML = "";
      // slidingPanelHeader.innerText = relatedBtnData.title;
      // slidingPanelText.innerText = relatedBtnData.description;
      showDescriAndTimeline(sidePanelContainer);
      relatedDiv.innerHTML = "";

      if (relatedBtnData.relates) {
        showRelated(sidePanelContainer.relates);
      } else {
        relatedDiv.innerHTML = "";
      }
      // }, 500);
    });

    elem.addEventListener("mouseover", () => {
      highLightTimeline(item.id);
    });
    elem.addEventListener("mouseleave", () => {
      removeHighLightTimeline();
    });

    // ---------------------------------------------------------------
  });
}
function showDescriAndTimeline(arr) {
  console.log(arr);
  let subjects = [];
  if (arr.description) {
    subjects.push("Description");
  }
  if (arr.relates && arr.relates.length !== 0) {
    subjects.push("Timeline");
  }
  // console.log(subjects);
  slidingPanelButtons.innerHTML = "";
  subjects.forEach((sub, index) => {
    const btn = document.createElement("button");
    btn.classList.add("sidePanelBtn");
    btn.innerText = sub;
    if (index === 0) {
      btn.classList.add("active");
    }
    slidingPanelButtons.appendChild(btn);
    slidingPanelHeader.innerText = arr.title;
    btn.addEventListener("click", () => {
      document
        .querySelectorAll(".sidePanelBtn")
        .forEach((btn) => btn.classList.remove("active"));
      btn.classList.add("active");

      if (btn.innerText === "Description") {
        slidingPanelText.innerHTML = "";
        slidingPanelText.innerText = arr.description;
      }
      if (btn.innerText === "Timeline") {
        slidingPanelText.innerHTML = "";
        console.log(arr.relates);

        const relatedEvents = data
          .filter((event) => {
            return event.relates && event.relates.includes(arr.id);
          })
          .filter((item) => item.date)
          .map((item) => item.date);

        console.log(arr.id);
        console.log(relatedEvents);
      }
    });
    slidingPanelText.innerText = arr.description;
  });
}

//--------------------------------------------------------------------
//------------------------HIGHLIGHT-TIMELINE------------------------
//--------------------------------------------------------------------

function highLightTimeline(id) {
  const additionalTimelines = document.querySelectorAll(".additional-timeline");
  additionalTimelines.forEach((timeline) =>
    timeline.classList.remove("highlight")
  );
  const [selectedTimeline] = [...additionalTimelines].filter((i) => i.id == id);
  if (selectedTimeline) {
    selectedTimeline.classList.add("highlight");
  }
}

//--------------------------------------------------------------------
//-----------------------REMOVE-HIGHLIGHT-TIMELINE--------------------
//--------------------------------------------------------------------

function removeHighLightTimeline() {
  const additionalTimelines = document.querySelectorAll(".additional-timeline");
  additionalTimelines.forEach((timeline) =>
    timeline.classList.remove("highlight")
  );
}

//--------------------------------------------------------------------
//-------------------------CHECK-FLAG-IS-TRUE-------------------------
//--------------------------------------------------------------------

function checkIsTrue() {
  if (isPrevBtn) {
    prevArrowBtn.classList.add("active");
  } else {
    prevArrowBtn.classList.remove("active");
  }
}

function myError() {
  alert("The image could not be loaded.");
}

const additionalTimelinesContainer = document.querySelector(
  ".additional-timelines"
);

// ----------------------------------------------------------------------------------------------
// ----------------------GENERATE-ADDITIONAL-TIMELINES-FROM-RELATES-ARRAY------------------------
// ----------------------------------------------------------------------------------------------

function generateTimelines(event) {
  if (!event.relates) {
    // additionalTimelinesContainer.innerHTML = "";
    additionalTimelinesContainer.style.height = "1px";
    // additionalTimelinesContainer.style.opacity = "0";

    document.querySelector(".frame-pointer").style.height = `41px`;
    return;
  }
  if (event.relates.length === 0) {
    additionalTimelinesContainer.style.height = "1px";
    document.querySelector(".frame-pointer").style.height = `41px`;
  }

  additionalTimelinesContainer.innerHTML = "";
  additionalTimelinesContainer.style.opacity = "0";

  const relatedData = [];

  event.relates.forEach((item) => {
    relatedData.push(
      ...data
        .filter((i) => i.id === item)
        .filter((item) => item.start_date && item.end_date)
        .map((item) => item.id)
    );
  });

  // console.log(relatedData);
  // if (relatedData.length === 0) {
  //   // additionalTimelinesContainer.style.height = "0px";

  //   document.querySelector(".frame-pointer").style.height = `40px`;
  // }

  relatedData.slice(0, 3).forEach((relate, index) => {
    //------------------return-every-item-where-id-is-included----------------------

    const relatedEvents = data.filter((event) => {
      return event.relates && event.relates.includes(relate);
    });

    // console.log(relatedEvents);
    // console.log(event);

    const dates = relatedEvents
      .map((i) => i.date)
      .sort((a, b) => a - b)
      .filter((i) => i);
    // console.log(dates);

    const [object] = data.filter((i) => i.id === relate);
    if (!object.start_date && !object.end_date) {
      return;
    }
    const startDate =
      object.start_date < dates[0] ? object.start_date : dates[0];

    const endDate =
      object.end_date > dates[dates.length - 1]
        ? object.end_date
        : dates[dates.length - 1];

    // createTimeline(startDate, endDate, index, object.id);
  });
}

// ------------------------------------------------------------------------------------------
// ----------------------------CREATE-TIMELINE-AND-ADD-DYNAMIC-STYLES------------------------
// ------------------------------------------------------------------------------------------

function createTimeline(start, end, index, id) {
  const line = document.createElement("div");
  line.classList.add("additional-timeline");
  line.classList.add(`line-${index + 1}`);
  line.id = id;
  line.style.left = `${agetoPixelConversion(start, years)}px`;
  line.style.width = `${
    agetoPixelConversion(end, years) - agetoPixelConversion(start, years)
  }px`;

  // setTimeout(() => {
  additionalTimelinesContainer.prepend(line);
  additionalTimelinesContainer.style.opacity = "1";
  // }, 500);

  additionalTimelinesContainer.style.height = `${(index + 1) * 20}px`;

  const pointerHeight = 40;
  document.querySelector(".frame-pointer").style.height = `${
    pointerHeight + (index + 1) * 20
  }px`;

  //   slidingHeader.style.bottom = `${(index + 1) * 35}px`;
}

const closeBtn = document.querySelector(".closeBtn");

closeBtn.addEventListener("click", () => {
  slidingPanel.classList.remove("active");
  mapContainer.classList.remove("active");
  document.querySelector(".leaflet-left").classList.remove("active");
  document.querySelector(".prev").classList.remove("active");
  showLayerBtn.classList.remove("active");
  setRoute.classList.remove("active");
  document
    .querySelector(".leaflet-top.leaflet-right")
    .classList.remove("active");
});

// --------------------------------------------------------------------
// ----------------------------LEAFLET-MAP-----------------------------
// --------------------------------------------------------------------

let zoom = 8;
let lat = 31.78246584395653;
let lon = 35.22766113281251;

let map = L.map("map").setView([lat, lon], zoom);

L.tileLayer(
  "https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png",
  {
    attribution:
      '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
  }
).addTo(map);

window.lrmConfig = {
  serviceUrl: "https://api.mapbox.com/directions/v5",
  profile: "mapbox/driving",
};

let control = L.Routing.control(
  L.extend(window.lrmConfig, {
    // waypoints: [L.latLng(52.228, 21.008), L.latLng(52.231, 21.015)],

    router: L.Routing.mapbox(
      "pk.eyJ1IjoibXdpbmllY2tpIiwiYSI6ImNrdGsxbHN1MjFoc3oydW51YjR1aHhpOTAifQ.FV2lrwzxlv8zl823_z5xKA"
    ),

    geocoder: L.Control.Geocoder.nominatim(),
    routeWhileDragging: true,
    lineOptions: {
      styles: [{ color: "#d7b221" }],
    },
    reverseWaypoints: true,
    // showAlternatives: true,
    // altLineOptions: {
    //   styles: [
    //     { color: "black", opacity: 0.15, weight: 9 },
    //     { color: "white", opacity: 0.8, weight: 6 },
    //     { color: "blue", opacity: 0.5, weight: 2 },
    //   ],
    // },
  })
).addTo(map);

L.Routing.errorControl(control).addTo(map);

// -------------------------------------------------------------------------------------
// --------------Get-lat-and-lng-from-data-and-put-it-to-another-array------------------
// -------------------------------------------------------------------------------------

const coordinates = isOnTimelineData.map((item) => {
  const { latitude, longitude, id } = item;
  return L.marker([latitude, longitude], { title: `${id}` });
});

// btns.forEach((btn) => {
//   if (btn.getAttribute("title") === "-4") {
//     centerButton(btn);
//     markerOpen(btn.id);
//   }
// });

// --------------------------------------------------------
// ----------------ADD-MARKERS-TO-MAP----------------------
// --------------------------------------------------------

for (let i = 0; i < coordinates.length; i++) {
  coordinates[i].addTo(map);
}
coordinates.forEach((coord) => {
  if (coord._latlng.lat === 0 && coord._latlng.lng === 0) {
    return;
  }
  coord.addTo(map);
});

// --------------------------------------------------------
// --------------MOVE-TO-MARKER-ON-CLICK-------------------
// --------------------------------------------------------

function markerOpen(id) {
  for (let i in coordinates) {
    const markerId = coordinates[i].options.title;
    if (markerId === id) {
      coordinates[i].openPopup();

      centerMarker(coordinates[i].getLatLng());
    }
  }
}

function centerMarker(latlng) {
  const marker = L.marker([latlng.lat, latlng.lng]);
  //   let group = new L.coordinatess([marker]);

  // map.fitBounds(group.getBounds());
  if (latlng.lat === 0 && latlng.lng === 0) {
    return;
  }

  map.flyTo([latlng.lat, latlng.lng], 11, {
    animate: true,
    duration: 6,
  });
}

// ----------------------------------------------------------------------------------------
// ------------------------------------ADD-ROUTING-TO-MAP----------------------------------
// ----------------------------------------------------------------------------------------

let polylinePoints = [
  [32.706786, 35.194556],
  [31.770011, 35.224564],
  [32.17967, 35.678333],
];

// console.log(polylinePoints);

let polyline = L.polyline(polylinePoints);

showLayerBtn.addEventListener("click", () => {
  if (!showLayerBtn.classList.contains("show")) {
    showLayerBtn.classList.add("show");
    map.addLayer(polyline);
  } else {
    showLayerBtn.classList.remove("show");
    map.removeLayer(polyline);
  }
});

setRoute.addEventListener("click", () => {
  if (
    document
      .querySelector(".leaflet-top.leaflet-right")
      .classList.contains("show")
  ) {
    document
      .querySelector(".leaflet-top.leaflet-right")
      .classList.remove("show");
    document.querySelector(".leaflet-top.leaflet-right").style.display = "none";
  } else {
    document.querySelector(".leaflet-top.leaflet-right").classList.add("show");
    document.querySelector(".leaflet-top.leaflet-right").style.display =
      "block";
  }
});

polyline.setStyle({
  color: "#d7b221",
});

// --------------------------------------------------------
// -----------ADD-FUNCTIONS-TO-BTNS-IN-TIMELINE------------
// --------------------------------------------------------

window.addEventListener("DOMContentLoaded", () => {
  const markersDiv = document.querySelectorAll(".btn");

  markersDiv.forEach((marker) => {
    marker.addEventListener("mouseup", () => {
      markerOpen(marker.id);
    });
  });
});

// --------------------------------------------------------
//------------ADD-FUNCTIONS-TO-MARKERS-IN-MAP--------------
// --------------------------------------------------------

window.addEventListener("DOMContentLoaded", () => {
  const markers = document.querySelectorAll(".leaflet-marker-icon");
  markers.forEach((marker) => {
    marker.addEventListener("click", () => {
      btns.forEach((btn) => {
        if (marker.title === btn.id) {
          centerButton(btn);
          markerOpen(btn.id);
        }
      });
    });
  });
});

// ------------------------------------------------------------------------------------
// ------------------------------CONVERT-AGE-TO-PIXEL----------------------------------
// ------------------------------------------------------------------------------------

function agetoPixelConversion(year, yearArr) {
  const highestYear = yearArr.find((elem) => elem > year);
  const lowerYear = yearArr[yearArr.indexOf(highestYear) - 1];

  const mainYears = document.querySelectorAll(".year-label");

  const lowYear = [...mainYears].filter((elem) => {
    if (+elem.children[0].innerText === lowerYear) {
      return year;
    }
  })[0].children[0];

  const highYear = [...mainYears].filter((elem) => {
    if (+elem.children[0].innerText === highestYear) {
      return year;
    }
  })[0].children[0];

  const lowRangePosition =
    lowYear.offsetLeft + lowYear.getBoundingClientRect().width / 2;
  const highRangePosition =
    highYear.offsetLeft + highYear.getBoundingClientRect().width / 2;

  const pixels = scale(
    year,
    lowerYear,
    highestYear,
    lowRangePosition,
    highRangePosition
  );
  return pixels;
}

function slideCenterHeader(currentSub) {
  if (currentSub.relates) {
    // const relatesNum = currentSub.relates.length;

    const relatesNum = [];
    currentSub.relates.forEach((item) =>
      relatesNum.push(
        ...data
          .filter((i) => i.id === item)
          .filter((item) => item.term_type === "person")
      )
    );

    // console.log(relatesNum.length);

    // console.log(relatesNum);

    if (relatesNum.length === 3 || relatesNum.length > 3) {
      slidingHeader.classList.add("up-3");
    }
    if (relatesNum.length === 2) {
      slidingHeader.classList.add("up-2");
    }
    if (relatesNum.length === 1) {
      slidingHeader.classList.add("up-1");
    }
    if (relatesNum.length === 0) {
      slidingHeader.classList.add("up");
    }
  } else {
    slidingHeader.classList.add("up");
  }
}

// ------------------------------------------------------------------------------------------
// --------Set-bottom-distance-between-sliding-header-and-upper-endge-of-timeline------------
// ------------------------------------------------------------------------------------------

function setBottom() {
  const containerHeight = timeLineContainer.offsetHeight;

  slidingHeader.classList.remove("down-3");
  slidingHeader.classList.remove("down-2");
  slidingHeader.classList.remove("down-1");
  slidingHeader.classList.remove("down");
  if (containerHeight === 182) {
    slidingHeader.classList.add("down-3");
  } else if (containerHeight === 162) {
    slidingHeader.classList.add("down-2");
  } else if (containerHeight === 142) {
    slidingHeader.classList.add("down-1");
  } else if (containerHeight === 123) {
    slidingHeader.classList.add("down");
  }
}

// ------------------------------------------------------------------------------------------
// -------------------------------------ZOOM-IN-/-ZOOM-OUT-LISTENERS-------------------------
// ------------------------------------------------------------------------------------------

// document.querySelector(".zoomIn").addEventListener("click", () => {
//   zoomIn();
// });

// document.querySelector(".zoomOut").addEventListener("click", () => {
//   zoomOut();
// });

// -----------------------------------------------------------------------------------------
// -------------------------------ZOOM-IN-/-ZOOM-OUT-FUNCTIONS------------------------------
// -----------------------------------------------------------------------------------------

function zoomIn() {
  if (zoomLevel >= 7) {
    return;
  }
  zoomLevel++;

  console.log(zoomLevel);
  // document.querySelectorAll(".year-label").forEach((year) => {
  //   year.style.width = `${year.offsetWidth + 200}px`;
  // });
  yearTimeline.innerHTML = "";
  years.forEach((year) => {
    const span = document.createElement("span");
    span.classList.add("year-label");
    span.innerHTML = `<time class="time">${year}</time>`;
    span.style.width = `${zoomLevel * 150}px`;
    yearTimeline.appendChild(span);
  });

  lineInner.style.width = yearTimeline.offsetWidth + "px";
  innerTimeline.style.width =
    yearTimeline.offsetWidth +
    lineBefore.getBoundingClientRect().width +
    lineAfter.getBoundingClientRect().width +
    "px";

  document.querySelectorAll(".btn").forEach((btn) => {
    btn.style.left = `${agetoPixelConversion(+btn.title, years)}px`;
  });

  centerButton(currentBtn);
  // updateYears();
}

function zoomOut() {
  if (zoomLevel <= 1) {
    return;
  }
  zoomLevel--;
  // document.querySelectorAll(".year-label").forEach((year) => {
  //   year.style.width = `${year.offsetWidth - 200}px`;
  // });
  console.log(zoomLevel);

  yearTimeline.innerHTML = "";
  years.forEach((year) => {
    const span = document.createElement("span");
    span.classList.add("year-label");
    span.innerHTML = `<time class="time">${year}</time>`;
    span.style.width = `${zoomLevel * 150}px`;
    yearTimeline.appendChild(span);
  });

  lineInner.style.width = yearTimeline.offsetWidth + "px";
  innerTimeline.style.width =
    yearTimeline.offsetWidth +
    lineBefore.getBoundingClientRect().width +
    lineAfter.getBoundingClientRect().width +
    "px";

  document.querySelectorAll(".btn").forEach((btn) => {
    btn.style.left = `${agetoPixelConversion(+btn.title, years)}px`;
  });

  centerButton(currentBtn);

  // centerButton(currentBtn);
}

//------------------------------------------------------------------------------------
//--------------------------SET-ADDITIONAL-YEARS-TO-MAIN-YEARS-ARRAY------------------
// -----------------------------------------------------------------------------------

function updateYears() {
  if (zoomLevel % 4 === 0 && zoomLevel !== 0) {
    const newYears = years
      .map((year, index, array) => {
        if (!array[index + 1]) {
          return;
        }

        const diff = (array[index] - array[index + 1]) / 2;
        return diff + array[index + 1];
      })
      .filter((item) => item);

    const zoomYears = [...newYears, ...years]
      .sort((a, b) => a - b)
      .filter((item) => item);

    yearTimeline.innerHTML = "";
    zoomYears.forEach((year) => {
      const span = document.createElement("span");
      span.classList.add("year-label");
      span.innerHTML = `<time class="time">${year}</time>`;
      yearTimeline.appendChild(span);
    });

    document.querySelectorAll(".year-label").forEach((year) => {
      year.style.width = `${year.offsetWidth + 50}px`;
    });

    lineInner.style.width = yearTimeline.offsetWidth + "px";

    innerTimeline.style.width =
      yearTimeline.offsetWidth +
      lineBefore.getBoundingClientRect().width +
      lineAfter.getBoundingClientRect().width +
      "px";

    document.querySelectorAll(".btn").forEach((btn) => {
      btn.style.left = `${agetoPixelConversion(+btn.title, zoomYears)}px`;
    });

    centerButton(currentBtn);
  }
}

// ----------------------------------------------------------------------------------------
// -------------------------JUMP-TO-ANOTHER-BTN-ON-TIMELINE--------------------------------
// ----------------------------------------------------------------------------------------

const prev = document.querySelector(".prev");
const next = document.querySelector(".next");

prev.addEventListener("click", () => {
  jumpToAnotherBtn("prev");
});
next.addEventListener("click", () => {
  jumpToAnotherBtn("next");
});

// ----------------------------------------------------------------------------------------
//---------------------JUMP-TO-ANOTHER-BTN-AFTER-CLICK-ARROW-BUTTON------------------------
// ----------------------------------------------------------------------------------------

function jumpToAnotherBtn(btn) {
  const index = [...btns].indexOf(currentBtn);
  prev.disabled = false;
  next.disabled = false;

  if (btn === "prev") {
    const prevBtn = [...btns][index - 1];

    centerButton(prevBtn);
    markerOpen(prevBtn.id);

    if (index === 1) {
      prev.disabled = true;
    }
  }

  if (btn === "next") {
    const nextBtn = [...btns][index + 1];
    if (!nextBtn) {
      next.disabled = true;
      return;
    }
    markerOpen(nextBtn.id);
    centerButton(nextBtn);
  }
}

window.addEventListener("keydown", function (e) {
  const index = [...btns].indexOf(currentBtn);
  let key = e.keyCode;
  if (key === 39) {
    const nextBtn = [...btns][index + 1];
    if (!nextBtn) {
      return;
    }
    centerButton(nextBtn);
  }
  if (key === 37) {
    const nextBtn = [...btns][index - 1];
    if (!nextBtn) {
      return;
    }
    centerButton(nextBtn);
  }
});
